`suspend` 키워드는 코루틴 내에서 함수가 일시적으로 실행을 중단하고, 나중에 다시 실행될 수 있게 하는 역할을 한다. 이 키워드를 사용한 함수는 호출할 때 코루틴 내에서만 실행될 수 있으며, 일반적인 함수 호출처럼 바로 실행되는 것이 아니라, 잠시 기다리거나 다른 작업을 처리하는 동안 중단될 수 있다. 이 기능은 비동기 작업을 처리할 때 유용하다. 비동기적으로 처리해야 하는 작업, 예시로는 네트워크 요청, 파일 입출력, 데이터베이스 접근을 할 때, `suspend` 함수를 사용하면 코드가 순차적으로 작성되기 때문에 코드 흐름이 동기처럼 보이지만 실제로는 비동기적으로 작업을 처리한다. 예를 들어, `suspend` 함수는 요청을 보내고 응답을 기다리는 동안 실행을 일시적으로 중단하여, 해당 작업이 끝날 때까지 다른 코드를 실행할 수 있게 한다. 이를 통해 스레드 차단을 피하고, 시스템 자원을 효율적으로 사용할 수 있다. `suspend` 키워드를 사용한 함수는 **일시 정지**와 **재개**를 지원하며, 이는 코루틴을 관리하는 라이브러리나 시스템에 의해 처리된다. 이 방식은 전통적인 비동기 방식보다 직관적이고 코드 작성이 간편하다.

컴파일러가 `suspend`를 처리하는 방식은 다음과 같다. 컴파일러가 `suspend` 키워드를 인식하면 함수 내부에서의 중단 가능 지점을 확인하고 중단 가능 지점을 기준으로 코드를 나누고, 함수를 상태 머신으로 변환한다. 상태 머신은 함수의 실행 상태를 추적하고 중단, 재개 시점을 관리한다.

**원본 코드:**

```kotlin
suspend fun fetchData(): String {
    delay(1000)
    return "Data"
}
```

이 코드는 `fetchData`라는 `suspend` 함수를 정의한다. 이 함수는 1초 동안 지연(`delay`)한 후 "Data"라는 문자열을 반환한다. `suspend` 키워드는 이 함수가 코루틴 내에서 실행될 수 있고, 실행 중에 일시 중단될 수 있음을 나타낸다.

**컴파일러에 의해 변환된 코드 (의사 코드):**
이건 이해를위한 의사 코드일뿐이다

```kotlin
fun fetchData(continuation: Continuation): Any? {
    when (continuation.state) {
        0 -> {
            continuation.state = 1
            delay(1000, continuation)
        }
        1 -> {
            return "Data"
        }
    }
    return COROUTINE_SUSPENDED
}
```

컴파일러는 `suspend` 함수를 `Continuation`이라는 객체를 매개변수로 받는 일반 함수로 변환한다. `Continuation` 객체는 코루틴의 현재 상태와 다음에 실행할 위치를 저장한다.

**코드 분석:**

1. **`continuation: Continuation`**: `continuation` 매개변수는 코루틴의 현재 상태와 다음 실행 위치를 저장하는 객체이다.
2. **`when (continuation.state)`**: `continuation.state`는 코루틴의 현재 상태이다. `when` 문은 상태에 따라 다른 코드를 실행한다.
3. **`0 -> { ... }`**: 상태가 0인 경우, `delay(1000, continuation)`을 호출하여 1초 동안 지연한다. `continuation.state = 1`은 지연이 완료된 후 실행될 다음 상태를 1로 설정한다. `delay` 함수는 `suspend` 함수이므로, 실행을 일시 중단하고 `continuation`을 사용하여 나중에 다시 시작한다.
4. **`1 -> { ... }`**: 상태가 1인 경우, "Data" 문자열을 반환한다. 이는 `delay` 함수가 완료된 후 실행되는 코드이다.
5. **`return COROUTINE_SUSPENDED`**: `COROUTINE_SUSPENDED`는 코루틴이 일시 중단되었음을 나타내는 특별한 값이다. `delay` 함수와 같은 `suspend` 함수가 호출되면 이 값이 반환된다.

**핵심 개념:**

* **상태 머신**: `continuation.state`는 코루틴의 실행 상태를 추적하는 데 사용된다.
* **Continuation**: `continuation` 객체는 코루틴의 현재 상태와 다음 실행 위치를 저장한다.
* **일시 중단 및 재개**: `delay` 함수는 실행을 일시 중단하고 `continuation`을 사용하여 나중에 다시 시작한다.

-----

suspend가 붙은 함수는

숙제 푸는것처럼 숙제를 하다가 다른일을 하다가 다시 숙제를 할수있는 것처럼

cpu가 함수를 처리하다가 다른 일을 처리하고 다시 함수를 처리하러 올수있는 함수이다